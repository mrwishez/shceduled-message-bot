name: Pachca Standup Reminder

on:
  schedule:
    # GitHub –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ UTC. 9:55 –ú–°–ö = 06:55 UTC.
    - cron: "55 6 * * 1-5"
  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫, —á—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É
  workflow_dispatch:
    inputs:
      message:
        description: "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"
        required: false
        default: "–í—Å—Ç—Ä–µ—á–∞–µ–º—Å—è –Ω–∞ –¥–µ–π–ª–∏ —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç!"

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–∞
        run: |
          if [ -z "${{ secrets.PACHCA_WEBHOOK_URL }}" ]; then
            echo "Secret PACHCA_WEBHOOK_URL –Ω–µ –∑–∞–¥–∞–Ω"; exit 1
          fi

      - name: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –ü–∞—á–∫—É
        env:
          WEBHOOK_URL: ${{ secrets.PACHCA_WEBHOOK_URL }}
          MSG_INPUT: ${{ github.event.inputs.message }}
        run: |
          MESSAGE="${MSG_INPUT:-‚è∞ –°—Ç–µ–Ω–¥–∞–ø! –í—Å—Ç—Ä–µ—á–∞–µ–º—Å—è –≤ 11:00 –ú–°–ö. –ü–æ–≥–Ω–∞–ª–∏ üöÄ}"
          # –ë–µ–∑–æ–ø–∞—Å–Ω–æ —Å–æ–±–µ—Ä—ë–º JSON (–±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
          ESCAPED_MESSAGE=$(python3 - <<'PY'
import json, os
print(json.dumps({"message": os.environ["MESSAGE"]}, ensure_ascii=False))
PY
)
          curl --fail --show-error --silent \
               -H "Content-Type: application/json" \
               -X POST "$WEBHOOK_URL" \
               -d "$ESCAPED_MESSAGE"
